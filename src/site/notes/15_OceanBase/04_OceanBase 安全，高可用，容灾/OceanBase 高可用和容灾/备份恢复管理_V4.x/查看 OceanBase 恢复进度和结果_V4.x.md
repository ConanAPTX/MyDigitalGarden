---
{"number headings":"auto, first-level 4, max 6, contents
{ #toc}
, start-at 1, _.1.1","dg-publish":true,"permalink":"/15_OceanBase/04_OceanBase 安全，高可用，容灾/OceanBase 高可用和容灾/备份恢复管理_V4.x/查看 OceanBase 恢复进度和结果_V4.x/","dgPassFrontmatter":true}
---


### 查看 OceanBase 恢复进度和结果_V4.x

#### 1 查看恢复进度和结果
```sql
-- 1.使用 `root` 用户登录数据库的 `sys` 租户；

-- 2.进入 `oceanbase` 数据库；
obclient> USE oceanbase;

-- 3.执行以下语句，查看恢复进度；
    obclient> SELECT * FROM oceanbase.CDB_OB_RESTORE_PROGRESS;
    +--------+-----------------+-----------+-----------------------+------------------+----------------------+-------------------+---------------------+-------------------------+---------------------+----------------------------+-----------------+-----------------+-------------------+------------------------+--------------------------+----------------------------+----------------------------+---------------------------+---------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------+------+
    | JOB_ID | EXTERNAL_JOB_ID | TENANT_ID | TENANT_NAME           | BACKUP_TENANT_ID | BACKUP_TENANT_NAME   | BACKUP_CLUSTER_ID | BACKUP_CLUSTER_NAME | WHITE_LIST              | STATUS              | START_TIME                 | COMPLETION_TIME | PARTITION_COUNT | MACRO_BLOCK_COUNT | FINISH_PARTITION_COUNT | FINISH_MACRO_BLOCK_COUNT | RESTORE_START_TIMESTAMP    | RESTORE_FINISH_TIMESTAMP   | RESTORE_CURRENT_TIMESTAMP | BACKUP_SET_LIST                                                                                   | BACKUP_PIECE_LIST                                                        | INFO |
    +--------+-----------------+-----------+-----------------------+------------------+----------------------+-------------------+---------------------+-------------------------+---------------------+----------------------------+-----------------+-----------------+-------------------+------------------------+--------------------------+----------------------------+----------------------------+---------------------------+---------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------+------+
    |      1 |              -1 |      1001 | restore_oracle_tenant |             1001 | backup_oracle_tenant |                 1 | cluster123          | `TEST`.`T1`,`TEST`.`T2` | RESTORE_SYS_REPLICA | 2021-12-15 20:52:38.283863 | NULL            |             128 |                -1 |                     67 |                       -1 | 2021-12-15 20:49:55.765179 | 2021-12-15 20:49:55.765179 | NULL                      | file:///data/nfs/backup/ob1.obc.obc/1/incarnation_1/1001/data/backup_set_1_full_20211215          | file:///data/nfs/backup/ob1.obc.obc/1/incarnation_1/1001/clog/1          |      |
    +--------+-----------------+-----------+-----------------------+------------------+----------------------+-------------------+---------------------+-------------------------+---------------------+----------------------------+-----------------+-----------------+-------------------+------------------------+--------------------------+----------------------------+----------------------------+---------------------------+---------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------+------+
    1 row in set

-- 4.待恢复完成后，您可以执行以下语句，查看集群的恢复任务结果和恢复历史；
-- 查看恢复任务结果
obclient> SELECT * FROM oceanbase.CDB_OB_RESTORE_PROGRESS;
+--------+-----------------+-----------+-----------------------+------------------+----------------------+-------------------+---------------------+------------+----------------------+----------------------------+-----------------+-----------------+-------------------+------------------------+--------------------------+----------------------------+----------------------------+---------------------------+---------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------+------+
| JOB_ID | EXTERNAL_JOB_ID | TENANT_ID | TENANT_NAME           | BACKUP_TENANT_ID | BACKUP_TENANT_NAME   | BACKUP_CLUSTER_ID | BACKUP_CLUSTER_NAME | WHITE_LIST | STATUS               | START_TIME                 | COMPLETION_TIME | PARTITION_COUNT | MACRO_BLOCK_COUNT | FINISH_PARTITION_COUNT | FINISH_MACRO_BLOCK_COUNT | RESTORE_START_TIMESTAMP    | RESTORE_FINISH_TIMESTAMP   | RESTORE_CURRENT_TIMESTAMP | BACKUP_SET_LIST                                                                                   | BACKUP_PIECE_LIST                                                        | INFO |
+--------+-----------------+-----------+-----------------------+------------------+----------------------+-------------------+---------------------+------------+----------------------+----------------------------+-----------------+-----------------+-------------------+------------------------+--------------------------+----------------------------+----------------------------+---------------------------+---------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------+------+
|      1 |              -1 |      1001 | restore_oracle_tenant |             1001 | backup_oracle_tenant |                 1 | cluster123          |            | RESTORE_USER_REPLICA | 2021-12-15 20:32:47.085544 | NULL            |              19 |                -1 |                      0 |                       -1 | 2021-12-15 20:30:40.877283 | 2021-12-15 20:31:23.140742 | NULL                      | file:///data/nfs/backup/ob1.obc.obc/1/incarnation_1/1001/data/backup_set_1_full_20211215          | file:///data/nfs/backup/ob1.obc.obc/1/incarnation_1/1001/clog/1          |      |
+--------+-----------------+-----------+-----------------------+------------------+----------------------+-------------------+---------------------+------------+----------------------+----------------------------+-----------------+-----------------+-------------------+------------------------+--------------------------+----------------------------+----------------------------+---------------------------+---------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------+------+
1 row in set

-- 查看恢复历史
obclient> SELECT * FROM oceanbase.CDB_OB_RESTORE_HISTORY;
+--------+-----------------+-----------+---------------------------+------------------+----------------------+-------------------+---------------------+------------+-----------------+----------------------------+----------------------------+-----------------+-------------------+------------------------+--------------------------+----------------------------+----------------------------+---------------------------+---------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------+------+
| JOB_ID | EXTERNAL_JOB_ID | TENANT_ID | TENANT_NAME               | BACKUP_TENANT_ID | BACKUP_TENANT_NAME   | BACKUP_CLUSTER_ID | BACKUP_CLUSTER_NAME | WHITE_LIST | STATUS          | START_TIME                 | COMPLETION_TIME            | PARTITION_COUNT | MACRO_BLOCK_COUNT | FINISH_PARTITION_COUNT | FINISH_MACRO_BLOCK_COUNT | RESTORE_START_TIMESTAMP    | RESTORE_FINISH_TIMESTAMP   | RESTORE_CURRENT_TIMESTAMP | BACKUP_SET_LIST                                                                                   | BACKUP_PIECE_LIST                                                        | INFO |
+--------+-----------------+-----------+---------------------------+------------------+----------------------+-------------------+---------------------+------------+-----------------+----------------------------+----------------------------+-----------------+-------------------+------------------------+--------------------------+----------------------------+----------------------------+---------------------------+---------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------+------+
|      1 |              -1 |      1001 | restore_oracle_tenant_new |             1001 | backup_oracle_tenant |                 1 | cluster123          |            | RESTORE_SUCCESS | 2021-12-15 19:25:01.271951 | 2021-12-15 19:26:34.966226 |             114 |                -1 |                    114 |                       -1 | 2021-12-15 19:21:45.577556 | 2021-12-15 19:21:45.577556 | NULL                      | file:///data/nfs/backup/ob1.obc.obc/1/incarnation_1/1001/data/backup_set_1_full_20211215          | file:///data/nfs/backup/ob1.obc.obc/1/incarnation_1/1001/clog/1          |      |
|      2 |              -1 |      1002 | restore_oracle_tenant     |             1001 | backup_oracle_tenant |                 1 | cluster123          |            | RESTORE_SUCCESS | 2021-12-15 19:27:27.730347 | 2021-12-15 19:29:20.666024 |             126 |                -1 |                    126 |                       -1 | 2021-12-15 19:21:45.577556 | 2021-12-15 19:23:10.491747 | NULL                      | file:///data/nfs/backup/ob1.obc.obc/1/incarnation_1/1001/data/backup_set_1_full_20211215          | file:///data/nfs/backup/ob1.obc.obc/1/incarnation_1/1001/clog/1          |      |
|      3 |              -1 |      1003 | restore_mysql_tenant      |             1002 | backup_mysql_tenant  |                 1 | cluster123          |            | RESTORE_SUCCESS | 2021-12-15 19:29:22.235016 | 2021-12-15 19:31:28.607833 |               7 |                -1 |                      7 |                       -1 | 2021-12-15 19:21:45.577556 | 2021-12-15 19:23:10.491747 | NULL                      | file:///data/nfs/backup/ob1.obc.obc/1/incarnation_1/1002/data/backup_set_1_full_20211215          | file:///data/nfs/backup/ob1.obc.obc/1/incarnation_1/1002/clog/1          |      |
+--------+-----------------+-----------+---------------------------+------------------+----------------------+-------------------+---------------------+------------+-----------------+----------------------------+----------------------------+-----------------+-------------------+------------------------+--------------------------+----------------------------+----------------------------+---------------------------+---------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------+------+
3 rows in set
```

还可以通过 OCP 查看恢复进度及结果，详情请查看参考文档；


```sql
-- 查看任务状态
SELECT * FROM __all_restore_info;
SELECT svr_ip,role, is_restore, COUNT(*) 
FROM __all_virtual_meta_table AS a, (SELECT value FROM __all_restore_info WHERE name='tenant_id') AS b 
WHERE a.tenant_id=b.value GROUP BY role, is_restore, svr_ip 
ORDER BY svr_ip, is_restore;
```



### 参考文档



