---
{"number headings":"auto, first-level 4, max 6, contents
{ #toc}
, start-at 1, _.1.1","dg-publish":true,"permalink":"/15_OceanBase/04_OceanBase 安全，高可用，容灾/OceanBase 备份恢复_v3.x/计算 OceanBase 备份存储空间大小/","dgPassFrontmatter":true}
---


### 文档名称
#### 1 计算 OceanBase 备份存储空间大小

##### 1.1 OB 备份策略
详细情况：[自动清理备份的数据](https://www.oceanbase.com/docs/enterprise-oceanbase-database-cn-10000000000355898)，；
备份保存时间：7天  
备份策略：  
全量备份：周一、周三、周五、周日；增量备份：周二、周四、周六  
  
最多可保留的全量数据备份（单位：次）：recovery_window/全量备份周期 + 2  
最多可保留的日志备份（单位：天）：最多可保留的全量备份数 * 全量备份周期  
  
需要额外预留的磁盘空间 = （保留的数据备份所占用的磁盘空间 + 保留的日志备份所占用的磁盘空间) * 30%  
  
  
  
##### 1.2 全量备份  
全量备份，增量备份目前压缩级别为1，按照数据量的 1-1.5 倍进行预留备份空间；

```
方法1:  
	255G * 4次 * 1.25 * 1.5 = 1912G = 1.86T  
  
方法2:  
	最多可保留的全量数据备份数 = recovery_window / 全量备份周期 + 2 = (7 / 2) + 2 = 5.5次  
	255G * 5.5次 * 1.5 = 2103G = 2.05T 
```
 
  
  
##### 1.3 增量备份
全量备份，增量备份目前压缩级别为1，按照数据量的 1-1.5 倍进行预留备份空间；
该方法是根据经验预估的；  

```
255G * 30% * 3次 * 1.25 * 1.5 = 430G = 0.42T  
```

  
  
##### 1.4 日志备份  

日志备份如果选择 lz4_1.0 算法，压缩比为 40% 左右，可以按照实际的数据大小进行估算。要预留大于 0.4 的空间； 
详细情况：[[15_OceanBase/03_OceanBase 高阶进阶/查询 clog 日志大小\|查询 clog 日志大小]]，；

```
8点到18点 Clog 日志大小 2.2 T，1天 Clog 大小预估为 4T，共需要保留 7天；因为有增量备份的存在，所以需要再 * 1.25 的系数；
方法1:   
	4T * 7天 * 1.25 = 35T * 0.6 = 21 T  

方法2:  
	最多可保留的全量数据备份数 = recovery_window / 全量备份周期 + 2 = (7 / 2) + 2 = 5.5次
	最多可保留的日志备份 = 最多可保留的全量数据备份数 * 全量备份周期 = 5.5 * 2 = 11天  
	4T * 11天 = 44T * 0.6 = 26.4T  
```

  
##### 1.5 总备份空间大小  
需要额外预留的磁盘空间 = （保留的数据备份所占用的磁盘空间 + 保留的日志备份所占用的磁盘空间) * 30% 

```
备份需要预留的最小磁盘空间大小 = (磁盘空间_1 + 磁盘空间_2 + 磁盘空间_3) * 130% 
	磁盘空间_1: 最多可保留的全量数据备份所占用的磁盘大小
	磁盘空间_2: 全量备份之间的所有增量备份所占用的磁盘空间
	磁盘空间_3: 最多可保留的日志备份所占用的磁盘大小
	130% : 需要额外预留的磁盘空间，一般为其他空间的 30%；
	
备份需要预留的最小磁盘空间大小 = (磁盘空间_1 + 磁盘空间_2 + 磁盘空间_3) * 130%  = (1.86T + 0.42T + 21T) * 1.3 = 23.28 * 1.3 = 30.26T
```



### 参考文档






